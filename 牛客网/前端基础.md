# 一、说一下http和https

## (1)http和https的基本概念

`http`: 超文本传输协议，是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），用于从WWW服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。

`https`: HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。

![image-20210221111354392](https://cdn.jsdelivr.net/gh/zangguojun/PicGo/20210221111406.png)

## (2)http和https的区别？

http传输的数据都是未加密的,https协议是由http和ssl协议构建的可进行加密传输和身份认证的网络协议，比http协议的安全性更高。

使用不同的链接方式，端口也不同，一般而言，http协议的端口为80，https的端口为443

## (3)http的缺点

**http协议中可能存在信息窃听或者身份伪装等安全问题**

### 1、 http通信使用明文（不加密），内容可能会被窃听

不管是不是使用加密都可能被窃听，只是说如果信息经过加密，就有可能让人无法破解报文的含义，但加密处理后的报文信息本身还是会被窃听到的。

![image-20210221114243483](https://cdn.jsdelivr.net/gh/zangguojun/PicGo/20210221114244.png)

### 2、不验证通信方的身份就可能遭遇伪装

 在 HTTP 协议通信时，由于不存在确认通信方的处理步骤，任何人都可以发起请求，另外，服务器只要接收到请求，不管对方是谁都会返回一个响应

* 无法确定Web服务器以及客户端是不是真正的服务器或者客户端
* 无法确定正在通信的对方是否具备访问权限，因为某些 Web 服务器上保存着重要的信息只想发给特定用户通 信的权限。 
* 无法判定请求是来自哪。 即使是无意义的请求也会照单全收。 无法阻止海量请  求下的 DoS 攻击（Denial of Service， 拒绝服务攻击）。

### 3、无法证明报文完整性， 可能已遭篡改

由于 HTTP 协议无法证明通信的报文完整性，因此，在请求或响应送出之后直到对方接收之前的这段时间内，即使请求或响应的内容遭到篡改，也没有办法获悉。 换句话说，没有任何办法确认，发出的请求 / 响应和接收到的请求 / 响应是前后相同的。比如，从某个 Web 网站上下载内容，是无法确定客户端下载的 文件和服务器上存放的文件是否前后一致的。文件内容在传输途中可能已经被篡改为其他的内容。即使内容真的已改变，作为接收方的客户端也是觉察不到的。像这样，请求或响应在传输途中，遭攻击者拦截并篡改内容的攻 击称为中间人攻击（Man-in-the-Middle attack，MITM）

![image-20210221123841806](https://cdn.jsdelivr.net/gh/zangguojun/PicGo/20210221123842.png)

## (4)ssl协议

 HTTPS使用SSL（Secure Scocket Layer ，安全套阶层）和TLS(Transport Layer Secure，安全层传输协议)这两种协议。TLS是以SSL为原型开发的协议，现在主流的版本是`SSL3.0`和`TLS1.0`。

## (5)有关https的SSL加密方式

**近代的加密方法中加密的方法是公共的，而密钥却是保密的，通过这种方式得以保持加密方法的安全性。--- 加盐**

**SSL采用一种叫做公开密钥加密（Public-Key cryptography）的加密处理方式**

### 1 共享密钥加密的困境

加密和解密同用一个密钥的方式称为共享密钥加密，也被叫做对称加密。

![img](https://user-gold-cdn.xitu.io/2018/12/24/167ddf5ad0b143eb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

共享加密的方式加密时必须将钥匙也发给对方，可究竟怎么样才能安全地转交，在互联网上转发密钥时，如果通信被监听那么密钥就可会落入攻击者之手，同时就失去了加密的意义。

发送密钥就有被窃听的风险，但不发送密钥，对方就不能解密，再说，密钥如果能安全的发送，那么数据也应该能安全的送达。

![img](https://user-gold-cdn.xitu.io/2018/12/24/167ddffa261df2be?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

### 2 使用两把密钥的公开密钥加密

公开密钥加密方式很好地解决了共享密码加密的困难。

公开密钥加密使用一对非对称的密钥。一把叫做私有密钥（private key），另一把叫做公开密钥（public key）。顾名思义，私有密钥不能让任何人知道，而公有密钥则可以随意发布 ，任何人都可以获得。

发送密文的一方使用对方的公有密钥进行加密处理，对方收到被加密的信息后，在使用自己私有的钥匙进行解密，这种方式，不需要发送用来解密的私钥，也不必担心密钥被攻击者窃听而盗走。

另外，要想根据密文和公开密钥，恢复到信息原文是异常困难的，因为解密加密工程就是对离散对数进行求值，这并非轻而易举的就能办到的，退一步讲，如果能对一个非常大的整数做到快速地因式分解，那么密钥破解还是存在希望的。但是目前的技术来看是不太现实的。

**即，如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法**

 常见的`非对称加密算法`有：RSA、ECC（移动设备用）、Diffie-Hellman、El Gamal、DSA（数字签名用）

常见的`对称加密算法`有DES、3DES、Blowfish、IDEA、RC4、RC5、RC6和AES 

### 3 HTTPS采用混合加密

https采用共享密钥加密和公开密钥加密两者并用的混合加密机制，若密钥能够实现安全的交换，那么有可能会考虑仅适用公开密钥加密通信。但是公开密钥加密与共享密钥加密相比，其处理速度要慢。

所以充分利用两者的优势，将方法组合起来用来通信，在交换密码环节使用公开密钥加密方式，之后建立通信交换报文阶段则使用共享密钥方式。

![img](https://user-gold-cdn.xitu.io/2018/12/24/167de179cc253585?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

**但是这样的也有些问题，就是公钥也有可能被拦截替换**

### 4 数字证书认证机构（CA,certificate Authority）的作用

**或许密钥在传输途中，真正的公开密钥已经被攻击者替换掉了。**

上面的问题可以使用由数字证书认证机构（CA,certificate Authority）和其相关颁发的公开密钥证书。数字证书认证机构处于是客户端和服务器双方可信赖的第三方机构立场上，威瑞信（veriSign）就是其中一家非常有名的数字证书认证机构。

简介一下数字证书认证机构的业务流程：

首先**，**服务器的运营人员向数字证书认证机构提出公钥的申请。数字证书认证机构在判明提出申请者的身份后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将公开密钥放入公钥证书后绑定在一起（**注意已签名的公共密钥和公开密码是两个不同的密钥，公开密钥是服务器提供的，已签名的公开密钥是签名机构自己生成的）**。

服务器会将这份数字认证机构颁发的公钥证书发送给客户端，已进行公开加密方式通信。公钥证书也可以叫做数字证书或直接称为证书。

接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，客户端便可以明确两件事情： 

​	1、 认证服务器的公开密钥是真实有效的数字证书认证机构。

​	2、服务器的公开密钥是值得信赖的。

![img](https://user-gold-cdn.xitu.io/2018/12/24/167dee825347aaa1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

**可证明组织真实性的EV SSL证书**

证书的一个作用是用来证明为通信一方的服务器是否规范，另外一个作用是可确定对方服务器背后运营的企业是否真实存在。拥有该特性的证书就是EV SSL证书（Extended Validation ssl Cretificate ）

EV SSL 证书是基于国际标准的认证指导方针颁发的证书，其严格规定了对运营商组织是否真实的确认方针，因此，用过认证的web网站能获得更高的认可度。上述机制的原意就是为了防止用户钓鱼攻击，很多用户可能不了解EV SSL证书相关的知识。

**用以确认客户端的客户端证书**

https中还可以使用客户端证书，以客户端证书进行客户端认证，证明服务器正在通信的客户端时预料之内的客户端，起作用和服务器证书如出一辙。

但客户端证书仍存在几处问题。其中的一个问题是证书的获取和发布。

想获取证书时，用户需要自行安装客户端证书，但客户端证书需要付费购买的，且每张证书对应到每位用户也就意味着需要支付和用户对等的费用。另外让知识层次不同的用户来自行安装证书，这是一件充满挑战的事情。

现在是，安全性极高的认证机构可颁发客户端证书但仅用于特殊用途的业务，比如有些可支撑客户端证书支出费用的业务。

例如，银行的网上银行就采用了客户端证书，在登录网银时不仅要求客户端确认输入ID和密码，还会要求用户的客户端证书，以确认用户时候从特定终端访问网银。

客户端证书存在的另一个问题是，客户端证书毕竟只能用来证明客户端实际存在，而不能用来证明用户本人的真实有效性。

### 5 当使用SSL时，它的速度会变慢。

![img](https://user-gold-cdn.xitu.io/2018/12/24/167df1aca887f46e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

SSL协议的慢分两种。

一种是指通信慢，另一种是指由于大量消耗CPU及内存资源，也会导致处理速度变慢。

除去和TCP连接、发送HTTP请求、响应之外，还必须进行ssl通信，因此整体上处理通信量不可避免会增加。

另外一点是SSL必须进行加密处理。在客户端和服务器都需要进行加密和解密的运算处理。因此从结果上讲，比起http会更多地消耗服务器和客户端的硬件资源，导致负载增强。

针对速度变慢这一问题，并没有从根本性的解决方案，但是可以使用SSL极速器这种（专用加速器）硬件来改善该问题。该硬件为ssl通信专用硬件，相对软件来讲，能够提高数倍ssl的计算速度。仅在ssl处理发挥ssl加速功效，以分担负载。

因此，如果非敏感信息则使用http通信，只有包含个人信息等敏感数据时 ，才会利用https。

除此之外，想要节约证书的开销也是原因之一。

### 6 HTTPS的安全通信机制

![img](https://user-gold-cdn.xitu.io/2018/12/24/167df3989d65afed?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

步骤1 ：客户端通过发送ClientHello报文开始SSL通信。报文中包含客户端支持的SSL的指定版本、加密组件列表（所使用的加密算法及密钥长度）。

步骤2：服务器进行SSL通信时，会以ServerHello 报文作为应答。和客户端一样，在报文中含有SSL的版本以及加密组件

步骤3： 之后服务器会发送 数字证书机构签名的数字证书（Cretificate，服务器公开钥匙+证书）。报文中包含公开密钥证书。

步骤4： 最后服务器发送Server Hello Done 报文通知客户端，最初阶段的SSL握手协议结束。

步骤5： SSL第一次握手结束之后，客户端以 Client key Exchange 报文作为回应。报文中包含通信加密中使用的一种称为Pre-master secret的随机密码串。该报文已被步骤3中的公开密钥进行加密。

步骤6：接着客户端继续发送Change Cipher Spec报文。该报文会提示服务器，次报文之后的通信会采用Per-master secret（共享）密钥加密

步骤7：客户端发送Finished报文。该报文包含连接至今全部报文的整体校验值。这次握手协商是否成功，要以服务器是否能够正确解密（共享密钥解密）该报文作为判断标准。

步骤8：服务器同样发送 Change Cipher Spec报文，该报文提示客户端，次报文之后的通信会采用Per-master secret（共享）密钥加密

步骤9：服务器同样发送Finished报文，该报文包含连接至今全部报文的整体校验。这次握手协商是否成功，要以客户端是否能够正确解密（共享密钥解密）改报文作为判断标准。

步骤10： 服务器和客户端的Finished报文交换之后，ssl连接算是建立完成。当然，通信会受到SSL的保护。从此开始进行应用层协议的通信，即发送http请求

步骤11：应用层协议通信，即发送http响应。

步骤12：最后由客户端断开连接。断开时，发送close_notify报文。上图做了一些省略，这部之后在发送TCP FIN 报文来关闭与TCP的通信

在以上流程中，应用层发送数据时会附加一种叫做MAC（masess authentication code）的报文摘要。MAC能够查知报文是否遭到篡改，从而保护报文的完整性。

下面是对整个流程的图解。途中说明了从使用服务器的公开密钥证书建立https通信的整个过程。![img](https://user-gold-cdn.xitu.io/2018/12/24/167df61e4eb95bde?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)