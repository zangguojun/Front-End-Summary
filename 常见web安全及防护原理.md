## sql注入原理及防范 

​	就是通过把SQL命令插入到Web表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。 

#### sql注入防范

1）永远不要信任用户的输入，要对用户的输入进行校验，可以通过正则表达式，或限制长度，对单引 号和双"-"进行转换等。 

2）永远不要使用动态拼装SQL，可以使用参数化的SQL或者直接使用存储过程进行数据查询存取。 

3）永远不要使用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接。 

4）不要把机密信息明文存放，请加密或者hash掉密码和敏感的信息。

## XSS原理及防范

​	Xss(cross-site scripting)攻击指的是攻击者往Web页面里插入恶意 html标签或者javascript代码。比 如：攻击者在论坛中放一个 看似安全的链接，骗取用户点击后，窃取cookie中的用户私密信息；或者攻击者在论坛中加一个恶意表 单， 当用户提交表单的时候，却把信息传送到攻击者的服务器中，而不是用户原本以为的信任站点。

#### XSS防范方法

​	首先代码里对用户输入的地方和变量都需要仔细检查长度和对”<”,”>”,”;”,”’”等字符做过滤；其次任何内容 写到页面之前都必须加以encode，避免不小心把html tag 弄出来。这一个层面做好，至少可以堵住超过 一半的XSS 攻击。

​	首先，避免直接在cookie 中泄露用户隐私，例如email、密码等等。 其次，通过使cookie 和系统ip 绑定来降低cookie 泄露后的危险。这样攻击者得到的cookie 没有实际价值，不可能拿来重放。 如果网站不需要再浏览器端对cookie 进行操作，可以在Set-Cookie 末尾加上HttpOnly 来防止javascript 代码直接获取cookie 。 尽量采用POST 而非GET 提交表单

## XSS与CSRF有什么区别

XSS是获取信息，不需要提前知道其他用户页面的代码和数据包。CSRF是代替用户完成指定的动作，需要知道其他用户页面的代码和数据包。 要完成一次CSRF攻击，受害者必须依次完成两个步骤： 登录受信任网站A，并在本地生成Cookie。 在不登出A的情况下，访问危险网站B。 

CSRF的防御服务端的CSRF方式方法很多样，但总的思想都是一致的，就是

+ 在客户端页面增加伪随机数。 

+ 通过验证码的方法

![Web安全之CSRF攻击](https://pic1.zhimg.com/v2-31e6d640aa10bade4e9c3666c39c5f7a_1440w.jpg?source=172ae18b)

![img](https://pic4.zhimg.com/80/v2-0bdbc7f56a9dac0b413f0e835acdbdfb_720w.jpg)**充分利用好cookie的SameSite属性**

SameSite选项通常由Strict、Lax和None三个值

- Strict最为严格，如果cookie设置了Strict，那么浏览器会完全禁止第三方Cookie。
- Lax相对宽松一点，在跨站点的情况下，从第三方站点的链接打开和从第三方站点提交Get的表单都会携带cookie.但是如果在第三方站点中使用Post方法或者通过img、iframe等标签加载的URL,都不会携带Cookie。
- None, 任何情况下都会发送Cookie。

**验证请求的来源站点**

在服务器端验证请求的来源站点。因为CSRF攻击大多数都是来自第三方站点。

通过http请求头中的Referer和Origin属性

- referer属性

记录了该http请求的来源地址，但有些场景不适合将来源URL暴露给服务器，所以可以设置不用上传，并且referer属性是可以修改的，所以在服务器端校验referer属性并没有那么可靠

- origin属性

通过XMLHttpRequest、Fetch发起的跨站请求或者Post方法发送请求时，都会带上origin,所以服务器可以优先判断Origin属性，再根据实际情况判断是否使用referer判断。

**CSRF Token**

除了上面两个方法之外，还可以使用CSRF Token来验证。

- 在浏览器向服务器发起请求时，服务器生成一个CSRF Token（字符串）发送给浏览器，然后将该字符串放入页面中
- 浏览器请求时（如表单提交）需要带上这个CSRF Token。服务器收到请求后，验证CSRF是否合法，如果不合法拒绝即可。









