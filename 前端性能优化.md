# 前端性能优化

## 一、减小资源大小

- `HTML压缩`HTML代码压缩就是压缩在文本文件中有意义，但是在HTML中不显示的字符，包括`空格`，`制表符`，`换行符`等.
- `CSS压缩`CSS压缩包括无效代码删除与CSS语义合并以及`空格`，`制表符`，`换行符`。
- `JS压缩与混淆`JS压缩与混乱包括无效字符及注释的删除、代码语义的缩减和优化、降低代码可读性，实现代码保护
- `图片压缩`针对真实图片情况，舍弃一些相对无关紧要的色彩信息
- `gzip压缩`HTTP协议上的GZIP编码是一种用来改进`WEB`应用程序性能的技术。大流量的WEB站点常常使用GZIP压缩技术来让用户感受更快的速度。这一般是指WWW服务器中安装的一个功能，当有人来访问这个服务器中的网站时，服务器中的这个功能就将网页内容压缩后传输到来访的电脑浏览器中显示出来。一般对纯文本内容可压缩到原大小的40%.

## 二、减少请求数量

+ **合并文件**
  + 公共库合并
  + 不同页面单独合并
+ **图片处理**
  + 精灵图 --- 把网站上的一些图片整合到一张单独的图片中
  + Base64 --- 将图片的内容以`Base64`格式内嵌到HTML中，可以减少`HTTP请求`
  + 字体图标来代替图片
+ **减少重定向**
  + 尽量避免使用[重定向](https://baike.baidu.com/item/重定向/9064196?fr=aladdin)，当页面发生了重定向，就会延迟整个HTML文档的传输。在HTML文档到达之前，页面中不会呈现任何东西，也没有任何组件会被下载，降低了用户体验
  + 如果一定要使用重定向，如http重定向到https，要使用`301永久重定向`，而不是`302临时重定向`。因为，如果使用302，则每一次访问http，都会被重定向到https的页面。而永久重定向，在第一次从http重定向到https之后 ，每次访问http，会直接返回https的页面
+ **使用缓存**
  + 由于浏览器会在DNS解析步骤中消耗一定的时间，所以，对于一些高访问量网站来说，做好DNS的缓存工作，就会一定程度上提升网站效率。
    + `CDN缓存`，CDN作为静态资源文件的分发网络，本身就已经提升了，网站静态资源的获取速度，加快网站的加载速度，同时也给静态资源做好缓存工作，有效的利用已缓存的静态资源，加快获取速度。
    + `http缓存`，也是给资源设定缓存时间，防止在有效的缓存时间内对资源进行重复的下载，从而提升整体网页的加载速度。
  + 使用`Cache-control`或`expires`这类强缓存时，缓存不过期的情况下，不向服务器发送请求。强缓存过期时，会使用`last-modified`或`etag`这类协商缓存，向服务器发送请求，如果资源没有变化，则服务器返回`304`响应，`浏览器继续从本地缓存加载资源；`如果资源更新了，则服务器将更新后的资源发送到浏览器，并返回`200`响应.。
  + 为了避免用户每次访问网站都得请求文件，我们可以通过添加 `Expires` 或 `max-age` 来控制这一行为。`Expires` 设置了一个时间，只要在这个时间之前，浏览器都不会请求文件，而是直接使用缓存。而 `max-age` 是一个相对时间，建议使用 `max-age` 代替 `Expires` 。不过这样会产生一个问题，当文件更新了怎么办？怎么通知浏览器重新请求文件？可以通过更新页面中引用的资源链接地址，让浏览器主动放弃缓存，加载新资源。具体做法是把资源地址 URL 的修改与文件内容关联起来，也就是说，只有文件内容变化，才会导致相应 URL 的变更，从而实现文件级别的精确缓存控制。什么东西与文件内容相关呢？我们会很自然的联想到利用[数据摘要要算法](https://baike.baidu.com/item/消息摘要算法/3286770?fromtitle=摘要算法&fromid=12011257)对文件求摘要信息，摘要信息与文件内容一一对应，就有了一种可以精确到单个文件粒度的缓存控制依据了。参考资料：

+ **不使用`CSS @import`**
  + CSS的`@import`会造成额外的请求

+ **使用空的src和href**
  + a标签设置空的`href`，会重定向到当前的页面地址
  + form设置空的`method`，会提交表单到当前的页面地址

## 三、网络连接的优化

+ 使用CND
  + CDN全称是`Content Delivery Network`，即内容分发网络，它能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。其目的是使用户可就近取得所需内容，解决 **Internet网络**拥挤的状况，提高用户访问网站的响应速度。

- 使用DNS预解析
  - 当浏览器访问一个域名的时候，需要解析一次DNS，获得对应域名的ip地址。在解析过程中，按照浏览器缓存、系统缓存、路由器缓存、ISP(运营商)DNS缓存、根域名服务器、顶级域名服务器、主域名服务器的顺序，逐步读取缓存，直到拿到IP地址

### 四、优化资源加载

+ **资源加载位置**

  > 通过优化资源加载位置，更改资源加载时机，使尽可能快地展示出页面内容，尽可能快地使功能可用
  + CSS文件放在`head中`，先外链，后本页

  + > **css文件** 放在`「head中」`，可以保证解析DOM的同时，解析css文件。因为，CSS（外链或内联）会阻塞整个DOM的渲染，然而DOM解析会正常进行，所以将css文件放在头部进行解析，可以加快网页的构建速度。

  + JS文件放在`body底部`，先外链，后本页

  + > **js文件**，将js文件放在尾部或者异步加载的原因是JS（外链或内联）会阻塞后续DOM的解析，后续DOM的渲染也将被阻塞，而且一旦js中遇到DOM元素的操作，很可能会影响。

  + 处理页面、处理页面布局的JS文件放在head中，如`babel-polyfill.js`文件、`flexible.js`文件

  + `body`中间尽量不写`style`标签和`script`标签

+ **资源加载时机**

  + 异步script标签
    + defer: 异步加载，在HTML解析完成后执行。defer的实际效果与将代码放在body底部类似
    + async: 异步加载，加载完成后立即执行
  + 模块按需加载

